load(
    "@bazel_skylib//rules:common_settings.bzl",
    "bool_flag",
    "string_flag",
)
load(
    "@rules_python//python:defs.bzl",
    "py_binary",
    "py_library",
)
load("@com_google_protobuf//:protobuf.bzl", "py_proto_library")

bool_flag(
    name = "use_persistent_workers",
    build_setting_default = True,
    visibility = ["//visibility:public"],
)

string_flag(
    name = "logging_level",
    build_setting_default = "information",
    values = [
        "trace",
        "debug",
        "information",
        "warning",
        "error",
    ],
    visibility = ["//visibility:public"],
)

py_binary(
    name = "driver",
    srcs = ["driver.py"],
    main = "driver.py",
    visibility = ["//visibility:public"],
    deps = [
        ":linker",
        "//idl_compiler:driver",
        "//idl_compiler:driver_binary_input",
        "//idl_compiler:driver_binary_output",
    ],
)

py_library(
    name = "linker",
    srcs = ["linker.py"],
    visibility = ["//idl_compiler/linker/archive:__subpackages__"],
    deps = [
        ":protocol_py_proto",
        "//idl_compiler/linker",
    ],
)

py_proto_library(
    name = "protocol_py_proto",
    srcs = ["protocol.proto"],
    visibility = ["//idl_compiler:__subpackages__"],
    deps = [
        "//idl_compiler/compiler/enumeration:protocol_py_proto",
        "//idl_compiler/compiler/function:protocol_py_proto",
        "//idl_compiler/compiler/handle:protocol_py_proto",
        "//idl_compiler/compiler/structure:protocol_py_proto",
    ],
)
