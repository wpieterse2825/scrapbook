load("@rules_python//python:defs.bzl", "py_library")
load("@com_google_protobuf//:protobuf.bzl", "py_proto_library")
load("//tools/idl/compiler:build.bzl", "idl_compiler_toolchain")

py_library(
    name = "compiler",
    srcs = ["compiler.py"],
    visibility = ["//tools/idl/compiler:__subpackages__"],
    deps = [
        ":shared_py_proto",
        "//tools/idl:shared",
    ],
)

py_proto_library(
    name = "shared_py_proto",
    srcs = ["shared.proto"],
    visibility = ["//tools/idl:__subpackages__"],
)

toolchain(
    name = "compiler_toolchain",
    toolchain = ":compiler_toolchain_impl",
    toolchain_type = ":toolchain_type",
)

toolchain_type(name = "toolchain_type")

idl_compiler_toolchain(
    name = "compiler_toolchain_impl",
    enumeration_compiler = "//tools/idl/compiler/enumeration:driver",
    function_compiler = "//tools/idl/compiler/function:driver",
    handle_compiler = "//tools/idl/compiler/handle:driver",
    structure_compiler = "//tools/idl/compiler/structure:driver",
)
